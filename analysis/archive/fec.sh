#!/bin/bash

d=$(date +'%b%d%Y' | tr '[:upper:]' '[:lower:]')
export PGHOST=localhost PGDATABASE="$d" PGUSER=postgres PGPASSWORD=
fec init
echo Created database "$d"
export PGHOST=localhost PGDATABASE="$d" PGUSER=postgres PGPASSWORD=

# Make a variable out of pyton script output with ...
# OUTPUT=($(python /path/path/script.py attr attr attr | tr -d '[],'))

echo Running fec_files.py

files=($(python3 ./etl/fec_files.py | tr -d "[],'"))

# files=(1405216 1411251 1411252 1411259 1413106 1411261 1413111 1410225 1411287 1413128 1411308 1413130 1411319 1413140 1405257 1413146 1408044 1410343 1410348 1406036 1405619 1394886 1406667 1406811 1413152 1413154 1413169 1413173 1411446 1406557 1410454 1405992 1405999 1411536 1410521 1410522 1404646 1404666 1404723 1414532 1414542 1410711 1413638 1413642 1411762 1413667 1412788 1412796 1410850 1411885 1412879 1401167 1412965 1410971 1412978 1401017 1401175 1413035 1411025 1402890 1413056 1411043 1413069 1411075 1411080 1411097 1411099 1411101 1401381 1401387 1411112 1411120 1401706 1411128 1411132 1411139 1411143 1411146 1401450 1401751 1411162 1411163 1411161 1411169 1411173 1411174 1403835 1411182 1411188 1407532 1408061 1408065 1408050 1408062 1408070 1408051 1408063 1408071 1407785 1407798 1407810 1407917 1407921 1407922 1407960 1407967 1407876 1407881 1407889 1407897 1407971 1407972 1407977 1407983 1407985 1407858 1407820 1407822 1408006 1408008 1407831 1407843 1407916 1407973 1407928 1407934 1407936 1407939 1407947 1407817 1407953 1407975 1407996 1407997 1407999 1408001 1407994 1408005 1408029 1408035 1408064 1408212 1408215 1408249 1408327 1411204 1411205 1411207 1411208 1408461 1411215 1411219 1408847 1408851 1408871 1408888 1408892 1408902 1411221 1408906 1408930 1408931 1408934 1408938 1408939 1408948 1408949 1408961 1408982 1408983 1408985 1411228 1409004 1409007 1409010 1409024 1409027 1409033 1409037 1409038 1409040 1409043 1411233 1409045 1409046 1409051 1409053 1409055 1409146 1409162 1409212 1411235 1409450 1409494 1409523 1411245)

for file in "${files[@]}"
    do
        curl -s "https://docquery.fec.gov/dcdev/posted/$file.fec" | fec convert $file --format=psql | psql    
    done

echo Running pgquery.py

$(python3 ./etl/pgquery.py)